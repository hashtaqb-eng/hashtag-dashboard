<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Hashtag Store</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    border-bottom: 2px solid #000;
    padding-bottom: 15px;
  }
  .login-logo {
    display: block;
    margin: 0 auto 15px;
    max-width: 90px;
    height: auto;
  }

  .logo {
    height: 80px;
  }

  .store-info {
    text-align: left;
    font-size: 14px;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Cairo', sans-serif;
    direction: rtl;
    background: #0a0a0a;
    color: #fff;
  }

  /* ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
  #loginPage {
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
  }

  .login-box {
    background: #111;
    padding: 40px;
    border-radius: 20px;
    border: 1px solid #333;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5);
  }

  .login-box h1 {
    color: #ffffff;
    margin-bottom: 10px;
    text-align: center;
  }

  .login-box p {
    color: #888;
    text-align: center;
    margin-bottom: 30px;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    color: #ddd;
    font-weight: 600;
  }

  .form-group input {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #333;
    background: #222;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    font-size: 14px;
    text-align: center;
    font-size: 18px;
    letter-spacing: 3px;
  }

  .form-group input:focus {
    outline: none;
    border-color: #ff0055;
  }

  .pin-input {
    font-family: monospace !important;
  }

  .btn-login {
    width: 100%;
    padding: 14px;
    background: #ff0055;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    font-weight: bold;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-login:hover {
    background: #cc0044;
    transform: translateY(-2px);
  }

  .error-msg {
    background: #ff0055;
    color: #fff;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: none;
    text-align: center;
  }

  .error-msg.show {
    display: block;
  }

  .login-info {
    text-align: center;
    color: #888;
    font-size: 13px;
    margin-top: 15px;
  }

  /* Dashboard */
  #dashboardPage {
    display: none;
  }

  #dashboardPage.show {
    display: block;
  }

  /* Header */
  .dashboard-header {
    background: #111;
    padding: 20px 30px;
    border-bottom: 1px solid #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
  }

  .dashboard-header h1 {
    color: #ff0055;
    font-size: 24px;
  }

  .header-actions {
    display: flex;
    gap: 10px;
    align-items: center;
  }

  .btn-logout {
    padding: 10px 20px;
    background: #555;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-logout:hover {
    background: #333;
  }

  .btn-refresh {
    padding: 10px 20px;
    background: #0070ff;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-refresh:hover {
    background: #0056cc;
  }

  .btn-delete-selected {
    padding: 10px 20px;
    background: #ff4444;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
    transition: all 0.3s;
    display: none;
  }

  .btn-delete-selected.show {
    display: block;
  }

  .btn-delete-selected:hover {
    background: #cc0000;
  }

  /* Stats Cards */
  .stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    padding: 30px;
  }

  .stat-card {
    background: #111;
    padding: 25px;
    border-radius: 15px;
    border: 1px solid #333;
    text-align: center;
    transition: all 0.3s;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    border-color: #ff0055;
  }

  .stat-card .icon {
    font-size: 40px;
    margin-bottom: 10px;
  }

  .stat-card .value {
    font-size: 32px;
    font-weight: bold;
    color: #ff0055;
    margin: 10px 0;
  }

  .stat-card .label {
    color: #888;
    font-size: 14px;
  }

  /* Search & Filter */
  .search-container {
    padding: 0 30px 20px;
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .search-input {
    flex: 1;
    min-width: 200px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #333;
    background: #111;
    color: #fff;
    font-family: 'Cairo', sans-serif;
  }

  .search-input:focus {
    outline: none;
    border-color: #ff0055;
  }

  .filter-select {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #333;
    background: #111;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
  }

  /* Orders Table */
  .table-container {
    padding: 0 30px 30px;
    overflow-x: auto;
  }

  .orders-table {
    width: 100%;
    background: #111;
    border-radius: 15px;
    overflow: hidden;
    border: 1px solid #333;
  }

  .orders-table table {
    width: 100%;
    border-collapse: collapse;
  }

  .orders-table th {
    background: #1a1a1a;
    padding: 15px;
    text-align: right;
    font-weight: 600;
    color: #ff0055;
    border-bottom: 2px solid #333;
  }

  .orders-table td {
    padding: 15px;
    border-bottom: 1px solid #222;
    text-align: right;
  }

  .orders-table tr:hover {
    background: #1a1a1a;
  }

  .status-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: bold;
  }

  .status-pending {
    background: #ff9800;
    color: #000;
  }

  .status-paid {
    background: #4caf50;
    color: #fff;
  }

  .status-cancelled {
    background: #f44336;
    color: #fff;
  }

  .status-preparing {
    background: #ffeb3b;
    color: #000;
  }

  .status-shipping {
    background: #2196f3;
    color: #fff;
  }

  .status-delivered {
    background: #4caf50;
    color: #fff;
  }

  .btn-view-items {
    padding: 8px 16px;
    background: #0070ff;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: 'Cairo', sans-serif;
    font-size: 13px;
    transition: all 0.3s;
  }

  .btn-view-items:hover {
    background: #0056cc;
  }

  /* Checkbox Styles */
  .checkbox-container {
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .order-checkbox {
    width: 20px;
    height: 20px;
    cursor: pointer;
    accent-color: #ff0055;
  }

  .order-checkbox:checked {
    background-color: #ff0055;
  }

  /* Items Modal */
  #itemsModal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    z-index: 9999;
    align-items: center;
    justify-content: center;
    overflow-y: auto;
  }

  #itemsModal.show {
    display: flex;
  }

  .modal-content {
    background: #111;
    padding: 30px;
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    border: 1px solid #444;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 2px solid #333;
  }

  .modal-header h2 {
    color: #ff0055;
  }

  .btn-close {
    background: #555;
    color: #fff;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 20px;
    transition: all 0.3s;
  }

  .btn-close:hover {
    background: #333;
    transform: rotate(90deg);
  }

  .order-details {
    margin-bottom: 25px;
  }

  .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid #222;
  }

  .detail-label {
    color: #888;
    font-weight: 600;
  }

  .detail-value {
    color: #fff;
    font-weight: bold;
  }

  .items-list {
    list-style: none;
    padding: 0;
  }

  .item-card {
    background: #1a1a1a;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    border: 1px solid #333;
  }

  .item-name {
    color: #ff0055;
    font-weight: bold;
    margin-bottom: 8px;
  }

  .item-details {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    font-size: 14px;
  }

  .item-details span {
    color: #888;
  }

  .item-details strong {
    color: #fff;
  }

  .loading {
    text-align: center;
    padding: 40px;
    color: #888;
  }

  .no-data {
    text-align: center;
    padding: 40px;
    color: #888;
  }

  /* Confirmation Modal */
  .confirmation-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 10000;
    align-items: center;
    justify-content: center;
  }

  .confirmation-modal.show {
    display: flex;
  }

  .confirmation-box {
    background: #111;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    border: 1px solid #444;
    text-align: center;
  }

  .confirmation-box h3 {
    color: #ff0055;
    margin-bottom: 20px;
  }

  .confirmation-box p {
    color: #ddd;
    margin-bottom: 25px;
    line-height: 1.5;
  }

  .confirmation-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
  }

  .btn-confirm {
    padding: 12px 25px;
    background: #ff4444;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-confirm:hover {
    background: #cc0000;
  }

  .btn-cancel {
    padding: 12px 25px;
    background: #555;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-cancel:hover {
    background: #333;
  }

  .modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
    border-top: 1px solid #333;
    padding-top: 20px;
  }

  .modal-buttons button {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    font-family: 'Cairo', sans-serif;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: bold;
  }

  .btn-print {
    background: #000;
    color: #fff;
  }

  .btn-print:hover {
    background: #222;
  }

  @media (max-width: 768px) {
    .dashboard-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .search-container {
      flex-direction: column;
    }
    
    .orders-table {
      font-size: 12px;
    }
    
    .orders-table th,
    .orders-table td {
      padding: 10px 8px;
    }
    
    .confirmation-actions {
      flex-direction: column;
    }

    .modal-buttons {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<div id="loginPage">
  <div class="login-box">
    <img 
      src="https://hashtaqb-eng.github.io/hashtag-dashboard/logo.png"
      class="login-logo"
      alt="Hashtag Logo"
    >
    <h1>Hashtag Black Dashboard</h1>
    <p>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</p>
    <div class="error-msg" id="errorMsg">PIN ØºÙŠØ± ØµØ­ÙŠØ­</div>
    <form onsubmit="login(); return false;">
      <div class="form-group">
        <label>Ø£Ø¯Ø®Ù„ PIN Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
        <input type="password" id="pin" placeholder="123456" required maxlength="6" class="pin-input">
      </div>
      <button type="submit" class="btn-login">ğŸ” Ø¯Ø®ÙˆÙ„</button>
      <div class="login-info">
        PIN Ù…ÙƒÙˆÙ† Ù…Ù† 6 Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
      </div>
    </form>
  </div>
</div>

<!-- ØµÙØ­Ø© Dashboard -->
<div id="dashboardPage">
  <!-- Header -->
  <div class="dashboard-header">
    <h1>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù…ØªØ¬Ø± Hashtag</h1>
    <div class="header-actions">
      <button class="btn-refresh" onclick="loadOrders()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
      <button class="btn-delete-selected" id="btnDeleteSelected" onclick="showDeleteConfirmation()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ (0)</button>
      <button class="btn-logout" onclick="logout()">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

  <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø§Øª-->
  <div class="stats-container">
    <div class="stat-card">
      <div class="icon">ğŸ“¦</div>
      <div class="value" id="totalOrders">0</div>
      <div class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div>
    </div>
    <div class="stat-card">
      <div class="icon">âœ…</div>
      <div class="value" id="paidOrders">0</div>
      <div class="label">Ø·Ù„Ø¨Ø§Øª Ù…Ø¯ÙÙˆØ¹Ø©</div>
    </div>
    <div class="stat-card">
      <div class="icon">â³</div>
      <div class="value" id="pendingOrders">0</div>
      <div class="label">Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
    </div>
    <div class="stat-card">
      <div class="icon">ğŸŸ¡</div>
      <div class="value" id="preparingOrders">0</div>
      <div class="label">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</div>
    </div>
    <div class="stat-card">
      <div class="icon">ğŸšš</div>
      <div class="value" id="shippingOrders">0</div>
      <div class="label">Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†</div>
    </div>
    <div class="stat-card">
      <div class="icon">ğŸ“</div>
      <div class="value" id="deliveredOrders">0</div>
      <div class="label">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</div>
    </div>
    <div class="stat-card">
      <div class="icon">âŒ</div>
      <div class="value" id="cancelledOrders">0</div>
      <div class="label">Ù…Ù„ØºÙŠ</div>
    </div>
    <div class="stat-card">
      <div class="icon">ğŸ’°</div>
      <div class="value" id="totalRevenue">0</div>
      <div class="label">Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª (AED)</div>
    </div>
  </div>

  <!-- Ø§Ù„Ø¨Ø­Ø« Ùˆ Ø§Ù„ÙÙ„ØªØ±Ø©-->
  <div class="search-container">
    <input type="text" class="search-input" id="searchInput" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ØŒ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ..." oninput="filterOrders()">
    <select class="filter-select" id="statusFilter" onchange="filterOrders()">
      <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option>
      <option value="Ù…Ø¯ÙÙˆØ¹">âœ… Ù…Ø¯ÙÙˆØ¹</option>
      <option value="Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±">â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</option>
      <option value="Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²">ğŸŸ¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</option>
      <option value="Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†">ğŸšš Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†</option>
      <option value="ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…">ğŸ“ ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</option>
      <option value="ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡">âŒ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡</option>
    </select>
  </div>

  <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
  <div class="table-container">
    <div class="orders-table">
      <table>
        <thead>
          <tr>
            <th style="width: 40px;">ØªØ­Ø¯ÙŠØ¯</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
            <th>Ref</th>
          </tr>
        </thead>
        <tbody id="ordersTableBody">
          <tr>
            <td colspan="9" class="loading">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
<div id="itemsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>ğŸ“¦ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h2>
      <button class="btn-close" onclick="closeItemsModal()">âœ•</button>
    </div>
    
    <div class="order-details" id="orderDetails"></div>

    <h3 style="color: #ff0055; margin-bottom: 15px; margin-top: 20px;">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</h3>
    <ul class="items-list" id="itemsList"></ul>

<div class="modal-buttons">
  <button class="btn-print" onclick="printCurrentOrder()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© / PDF</button>
</div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="confirmation-modal" id="confirmationModal">
  <div class="confirmation-box">
    <h3>âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h3>
    <p id="confirmationMessage">Ø³ÙŠØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹. Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.</p>
    <div class="confirmation-actions">
      <button class="btn-confirm" onclick="confirmDelete()">Ù†Ø¹Ù…ØŒ Ø§Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
      <button class="btn-cancel" onclick="cancelDelete()">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
  </div>
</div>

<script>
// Ø±Ø§Ø¨Ø· Google Apps Script
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzfXizbMcpqHipXdPe9nFKhojiIvXDzxSyaKTYonJx8y4glcXA4Hn442Zk0vu41coKipg/exec";

// PIN Ø§Ù„Ù…Ø®Ø²Ù† Ù…Ø­Ù„ÙŠØ§Ù‹
let currentPin = "";

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± PIN ÙÙ‚Ø·
async function login() {
  const pin = document.getElementById('pin').value.trim();
  
  if (!pin || pin.length < 4) {
    document.getElementById('errorMsg').textContent = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ PIN ØµØ­ÙŠØ­";
    document.getElementById('errorMsg').classList.add('show');
    return;
  }

  try {
    const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=login&pin=${encodeURIComponent(pin)}`);
    const data = await response.json();
    
    if (data.success) {
      // Ø­ÙØ¸ PIN Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù„Ø§Ø­Ù‚Ø§Ù‹
      currentPin = pin;
      
      document.getElementById('errorMsg').classList.remove('show');
      document.getElementById('loginPage').style.display = 'none';
      document.getElementById('dashboardPage').classList.add('show');
      loadOrders();
    } else {
      document.getElementById('errorMsg').textContent = "PIN ØºÙŠØ± ØµØ­ÙŠØ­";
      document.getElementById('errorMsg').classList.add('show');
    }
  } catch (error) {
    console.error('Login error:', error);
    document.getElementById('errorMsg').textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…";
    document.getElementById('errorMsg').classList.add('show');
  }
}

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
function logout() {
  if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
    currentPin = "";
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('dashboardPage').classList.remove('show');
    document.getElementById('pin').value = '';
    selectedOrders.clear();
    updateDeleteButton();
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Google Sheet
async function loadOrders() {
  if (!currentPin) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    logout();
    return;
  }

  try {
    const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getOrders&pin=${encodeURIComponent(currentPin)}`);
    const data = await response.json();

    if (data.success && data.orders) {
      allOrders = data.orders;
    } else {
      allOrders = [];
    }

    filteredOrders = allOrders;
    selectedOrders.clear();
    updateStats();
    renderOrders();
    updateDeleteButton();

  } catch (error) {
    console.error(error);
    alert("âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª");
  }
}

let allOrders = [];
let filteredOrders = [];
let selectedOrders = new Set();
let currentOrderForPrint = null;

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function updateStats() {
  const total = allOrders.length;
  const paid = allOrders.filter(o => o.status === 'Ù…Ø¯ÙÙˆØ¹').length;
  const pending = allOrders.filter(o => o.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±').length;
  const preparing = allOrders.filter(o => o.status === 'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²').length;
  const shipping = allOrders.filter(o => o.status === 'Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†').length;
  const delivered = allOrders.filter(o => o.status === 'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…').length;
  const cancelled = allOrders.filter(o => o.status === 'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡').length;

  // âœ… Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª: ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ù…Ø§ Ø¹Ø¯Ø§ (Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± + ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡)
  const revenue = allOrders
    .filter(o =>
      o.status !== 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' &&
      o.status !== 'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡'
    )
    .reduce((sum, o) => sum + parseFloat(o.total || 0), 0);
  document.getElementById('totalOrders').innerText = total;
  document.getElementById('paidOrders').innerText = paid;
  document.getElementById('pendingOrders').innerText = pending;
  document.getElementById('preparingOrders').innerText = preparing;
  document.getElementById('shippingOrders').innerText = shipping;
  document.getElementById('deliveredOrders').innerText = delivered;
  document.getElementById('cancelledOrders').innerText = cancelled;
  document.getElementById('totalRevenue').innerText = revenue.toFixed(2);
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
function renderOrders() {
  const tbody = document.getElementById('ordersTableBody');
  
  if (filteredOrders.length === 0) {
    tbody.innerHTML = '<tr><td colspan="9" class="no-data">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</td></tr>';
    return;
  }
  
  tbody.innerHTML = filteredOrders.map(order => `
    <tr>
      <td class="checkbox-container">
        <input 
          type="checkbox" 
          class="order-checkbox" 
          data-order-id="${order.orderId}"
          onchange="toggleOrderSelection('${order.orderId}')"
          ${selectedOrders.has(order.orderId) ? 'checked' : ''}
        >
      </td>
      <td>${order.orderId}</td>
      <td>${order.date}</td>
      <td>${order.customerName}</td>
      <td>${order.customerPhone}</td>
      <td>${order.total} AED</td>
      <td><span class="status-badge status-${getStatusClass(order.status)}">${order.status}</span></td>
      <td><button class="btn-view-items" onclick='viewItems(${JSON.stringify(order).replace(/'/g, "&apos;")})'>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button></td>
      <td>${order.ref || '-'}</td>
    </tr>
  `).join('');
}

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ class Ø§Ù„Ø­Ø§Ù„Ø©
function getStatusClass(status) {
  const statusMap = {
    'Ù…Ø¯ÙÙˆØ¹': 'paid',
    'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±': 'pending',
    'Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²': 'preparing',
    'Ù…Ø¹ Ø´Ø±ÙƒØ© Ø§Ù„Ø´Ø­Ù†': 'shipping',
    'ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…': 'delivered',
    'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡': 'cancelled'
  };
  return statusMap[status] || 'pending';
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function filterOrders() {
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  
  filteredOrders = allOrders.filter(order => {
    const matchesSearch = 
      order.orderId.toLowerCase().includes(searchTerm) ||
      order.customerName.toLowerCase().includes(searchTerm) ||
      order.customerPhone.includes(searchTerm);
    
    const matchesStatus = !statusFilter || order.status === statusFilter;
    
    return matchesSearch && matchesStatus;
  });
  
  renderOrders();
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function toggleOrderSelection(orderId) {
  if (selectedOrders.has(orderId)) {
    selectedOrders.delete(orderId);
  } else {
    selectedOrders.add(orderId);
  }
  updateDeleteButton();
}

// ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø°Ù
function updateDeleteButton() {
  const btnDeleteSelected = document.getElementById('btnDeleteSelected');
  const count = selectedOrders.size;
  
  if (count > 0) {
    btnDeleteSelected.classList.add('show');
    btnDeleteSelected.textContent = `ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ (${count})`;
  } else {
    btnDeleteSelected.classList.remove('show');
  }
}

// Ø¹Ø±Ø¶ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
function showDeleteConfirmation() {
  const count = selectedOrders.size;
  if (count === 0) return;
  
  const message = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${count} Ø·Ù„Ø¨${count > 1 ? 'Ø§Øª' : ''}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`;
  document.getElementById('confirmationMessage').textContent = message;
  document.getElementById('confirmationModal').classList.add('show');
}

// Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø­Ø°Ù
function cancelDelete() {
  document.getElementById('confirmationModal').classList.remove('show');
}

// ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù
async function confirmDelete() {
  if (!currentPin) {
    alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    return;
  }

  try {
    const ordersToDelete = Array.from(selectedOrders);
    
    const response = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify({
        action: 'deleteMultiple',
        orderIds: ordersToDelete,
        pin: currentPin
      })
    });

    const data = await response.json();
    
    if (data.success) {
      document.getElementById('confirmationModal').classList.remove('show');
      await loadOrders();
      alert(`âœ… ØªÙ… Ø­Ø°Ù ${data.deletedCount || ordersToDelete.length} Ø·Ù„Ø¨${(data.deletedCount || ordersToDelete.length) > 1 ? 'Ø§Øª' : ''} Ø¨Ù†Ø¬Ø§Ø­`);
    } else {
      alert(`âŒ Ø®Ø·Ø£: ${data.message || data.error || "ØºÙŠØ± Ù…ØµØ±Ø­"}`);
    }
    
  } catch (error) {
    alert(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±:\n${error.message}`);
  }
}

// Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function viewItems(order) {
  currentOrderForPrint = order;
  const modal = document.getElementById('itemsModal');
  const detailsDiv = document.getElementById('orderDetails');
  const itemsList = document.getElementById('itemsList');
  
  // ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨
  detailsDiv.innerHTML = `
    <div class="detail-row">
      <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</span>
      <span class="detail-value">${order.orderId}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
      <span class="detail-value">${order.date}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</span>
      <span class="detail-value">${order.customerName}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</span>
      <span class="detail-value">${order.customerPhone}</span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ø­Ø§Ù„Ø©:</span>
      <span class="detail-value"><span class="status-badge status-${getStatusClass(order.status)}">${order.status}</span></span>
    </div>
    <div class="detail-row">
      <span class="detail-label">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
      <span class="detail-value">${order.total} AED</span>
    </div>
  `;
  
  // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
  const items = parseItems(order.items);
  itemsList.innerHTML = items.map(item => `
    <li class="item-card">
      <div class="item-name">${item.name}</div>
      <div class="item-details">
        <span>Ø§Ù„Ù…Ù‚Ø§Ø³: <strong>${item.size}</strong></span>
        <span>Ø§Ù„ÙƒÙ…ÙŠØ©: <strong>${item.qty}</strong></span>
        <span>Ø§Ù„Ø³Ø¹Ø±: <strong>${item.price} AED</strong></span>
      </div>
    </li>
  `).join('');
  
  modal.classList.add('show');
}

// Ø¥ØºÙ„Ø§Ù‚ Modal
function closeItemsModal() {
  document.getElementById('itemsModal').classList.remove('show');
}

// ØªØ­Ø¯ÙŠØ¯ Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬ Ø­Ø³Ø¨ Ø§Ø³Ù…Ù‡
function getProductPrice(productName) {
  const prices = {
    "Hashtag BOSS": 110,
    "Hashtag DIVA": 110,
    "Hashtag BOTH": 110,
    "LIGHT Hashtag": 110,
    "Cozy": 350
  };

  for (const key in prices) {
    if (productName.includes(key)) {
      return prices[key];
    }
  }

  return 0;
}

// ØªØ­Ù„ÙŠÙ„ Ù†Øµ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
function parseItems(itemsText) {
  const items = [];
  const parts = itemsText.split('|');

  parts.forEach(part => {
    const match = part.match(/\d+\.\s*(.+?)\s*\((.+?)\)\s*x(\d+)/);
    if (match) {
      const name = match[1].trim();
      const size = match[2].trim();
      const qty = parseInt(match[3]);

      const price = getProductPrice(name);

      items.push({
        name,
        size,
        qty,
        price
      });
    }
  });

  return items;
}

// Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
function printCurrentOrder() {
  if (!currentOrderForPrint) {
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©");
    return;
  }
  const LOGO_URL = "https://hashtaqb-eng.github.io/hashtag-dashboard/logo.png";
  const items = parseItems(currentOrderForPrint.items);

  let rows = "";
  let total = 0;

  items.forEach((item, i) => {
    const sub = item.price * item.qty;
    total += sub;
    rows += `
      <tr>
        <td>${i + 1}</td>
        <td>${item.name}</td>
        <td>${item.size}</td>
        <td>${item.qty}</td>
        <td>${item.price} AED</td>
        <td>${sub} AED</td>
      </tr>
    `;
  });
// ØªØ­Ø¯ÙŠØ¯ Ù‡Ù„ ÙŠØ¹ØªØ¨Ø± Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¯ÙÙˆØ¹
const isPaid =
  currentOrderForPrint.status !== 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±' &&
  currentOrderForPrint.status !== 'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡';
const paymentBadge = isPaid
  ? `<div class="paid-badge">âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹</div>`
  : `<div class="unpaid-badge">â³ ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹</div>`;

  const win = window.open("", "", "width=900,height=700");
  win.document.write(`
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Invoice - Hashtag</title>
<style>
@media print {
  body {
    background: #fff !important;
    color: #000 !important;
  }
}
body {
  font-family: Cairo, sans-serif;
  direction: rtl;
  background: #fff;
  color: #000;
  padding: 30px;
}
.invoice {
  max-width: 800px;
  margin: auto;
  border: 2px solid #000;
  padding: 30px;
}
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 3px solid #000;
  padding-bottom: 15px;
  margin-bottom: 20px;
}
.invoice-logo {
  max-width: 120px;
  max-height: 80px;
  object-fit: contain;
}
.paid-badge {
  background: #000;
  color: #fff;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: bold;
  text-align: center;
  margin: 15px auto;
  width: fit-content;
  font-size: 16px;
}

.unpaid-badge {
  background: #ccc;
  color: #000;
  padding: 10px 18px;
  border-radius: 8px;
  font-weight: bold;
  text-align: center;
  margin: 15px auto;
  width: fit-content;
  font-size: 16px;
}

.company-info {
  text-align: right;
  font-size: 14px;
}
.invoice-title {
  text-align: center;
  font-size: 26px;
  font-weight: bold;
  margin: 20px 0;
}
.info-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 20px;
  font-size: 14px;
}
.info-grid div {
  border: 1px solid #000;
  padding: 8px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}
th, td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
  font-size: 14px;
}
th {
  background: #000;
  color: #fff;
}
.total {
  margin-top: 20px;
  text-align: left;
  font-size: 18px;
  font-weight: bold;
}
.footer {
  margin-top: 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top: 2px dashed #000;
  padding-top: 15px;
  font-size: 13px;
}
.qr img {
  width: 90px;
  height: 90px;
}
</style>
</head>
<body>
<div class="invoice">
  <div class="header">
    <img src="${LOGO_URL}" class="invoice-logo">
    <div class="company-info">
      <strong>Hashtag Black</strong><br>
      United Arab Emirates<br>
      https://hashtagblack.carrd.co
    </div>
  </div>
  <div class="invoice-title">INVOICE</div>
${paymentBadge}
  <div class="info-grid">
    <div><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${currentOrderForPrint.orderId}</div>
    <div><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${currentOrderForPrint.date}</div>
    <div><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${currentOrderForPrint.customerName}</div>
    <div><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${currentOrderForPrint.customerPhone}</div>
  </div>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
        <th>Ø§Ù„Ù…Ù‚Ø§Ø³</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ø³Ø¹Ø±</th>
        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
      </tr>
    </thead>
    <tbody>
      ${rows}
    </tbody>
  </table>
  <div class="total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${total} AED</div>
  <div class="footer">
    <div>
      Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ³ÙˆÙ‚ÙƒÙ… Ù…Ù† Hashtag ğŸ–¤<br>
      This invoice is computer generated.
    </div>
    <div class="qr">
      <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent('https://hashtaqb-eng.github.io/hashtagblackqrcodecheack/?orderId=' + currentOrderForPrint.orderId)}">
    </div>
  </div>
</div>
</body>
</html>
`);

  win.document.close();
  win.print();
}

// Ø¥ØºÙ„Ø§Ù‚ Modal Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
window.onclick = function(event) {
  const modal = document.getElementById('itemsModal');
  if (event.target === modal) {
    closeItemsModal();
  }
  
  const confirmationModal = document.getElementById('confirmationModal');
  if (event.target === confirmationModal) {
    cancelDelete();
  }
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Enter ÙÙŠ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('pin').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      login();
    }
  });
  
  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ PIN Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  document.getElementById('pin').focus();
});
</script>
</body>
</html>

